# OpenCode IDE 基础需求参考

> 生成时间：2026-02-18  
> 项目目标：仿制 OpenCode Desktop IDE 界面 - 基础版本

---

## 1. 项目概述

| 项目属性 | 说明 |
|---------|------|
| **项目名称** | OpenCode Desktop IDE |
| **类型** | AI 驱动编程助手桌面应用 |
| **技术栈** | Next.js 16 + React 19 + TypeScript + Tailwind CSS |
| **架构** | 客户端/服务器分离架构（可远程连接） |

---

## 2. 整体布局结构

```
┌─────────────────────────────────────────────────────┐
│ Activity Bar │ Sidebar │     Content Area          │
│  (48px)      │ (可变)   │      (自适应)              │
│              │         ├───────────────────────────┤
│  ┌──────┐    │ 文件树/ │ │ Chat Panel / Editor /   │
│  │ Chat │    │ 会话列表 │ │ Repository Panel        │
│  │ Edit │    │         │ │                         │
│  │ Repo │    │         │ ├─────────────────────────┤
│  │ ⚙️   │    │         │ │ Status Bar              │
│  └──────┘    │         │ │ (底部 22px)             │
└──────────────┴─────────┴───────────────────────────┘
```

---

## 3. 组件清单与规格

### 3.1 Activity Bar（活动栏）

| 属性 | 规格 |
|-----|------|
| **位置** | 最左侧，固定 48px 宽 |
| **背景色** | `#2d2d2d` |
| **功能按钮** | Chat / Editor / Repository / Settings |
| **交互** | 点击切换主面板，当前项高亮显示左边框 |
| **图标大小** | 24px |

### 3.2 Sidebar（侧边栏）

| 模式 | 内容 | 功能 |
|-----|------|------|
| **Explorer 模式** | 文件树 | 展示项目结构，支持展开/折叠文件夹 |
| **Sessions 模式** | 会话列表 | 显示历史对话会话 |
| **宽度** | 可调整（默认 200-300px） | 可拖拽调整 |

**文件树组件：**
- 支持图标：文件夹（黄色）、代码文件、文档、表格
- 支持点击展开/折叠
- 文件点击在 Editor 中打开

### 3.3 Chat Panel（聊天面板）

#### 3.3.1 消息展示区

| 元素 | 规格 |
|-----|------|
| **消息气泡** | 用户右对齐（蓝色背景），AI 左对齐（灰色背景） |
| **图片附件** | 左上角显示缩略图（80x80px） |
| **AI 思考指示器** | 显示 `# 正在考虑下一步 · X分钟X秒` |

#### 3.3.2 输入区

| 组件 | 功能 |
|-----|------|
| **输入框** | 多行文本，支持自动高度（40px-200px） |
| **粘贴按钮** | 支持从剪贴板粘贴图片 |
| **发送按钮** | 圆形，蓝色背景，带加载动画 |
| **快捷键** | Enter 发送，Shift+Enter 换行 |

#### 3.3.3 特殊功能

- **@ 符号引用**：输入 `@` 触发文件模糊搜索
- **/ 命令**：输入 `/` 显示命令列表（如 `/help`, `/compact`）
- **图片粘贴**：支持直接粘贴截图或图片文件

### 3.4 Editor Panel（编辑器面板）

| 功能 | 说明 |
|-----|------|
| **编辑器** | Monaco Editor（VS Code 同款） |
| **标签页** | 顶部标签栏，支持多文件切换 |
| **文件类型支持** | 代码、文档（Markdown）、表格（Excel/CSV） |
| **对比视图** | 支持代码 diff 显示 |

### 3.5 Repository Panel（仓库面板）

| 区域 | 内容 |
|-----|------|
| **仓库信息** | 仓库名称、当前分支 |
| **分支列表** | 可切换分支 |
| **提交历史** | 显示最近提交记录 |

### 3.6 Status Bar（状态栏）

| 位置 | 内容 |
|-----|------|
| **左侧** | Git 分支图标 + 分支名、仓库名 |
| **右侧** | 编码（UTF-8）、文件类型、行列位置（Ln X, Col Y） |
| **高度** | 22px |
| **背景色** | `#0078d4`（蓝色） |

---

## 4. 状态管理需求

### 4.1 全局状态（Zustand）

```typescript
interface AppState {
  // 当前激活的面板
  activeTab: 'chat' | 'editor' | 'repository';
  
  // 侧边栏宽度
  sidebarWidth: number;
  
  // 当前分支
  currentBranch: string;
  
  // 仓库信息
  repository: { name: string; path: string } | null;
  
  // 打开的文件列表
  openFiles: File[];
  
  // 当前活跃文件
  activeFile: File | null;
  
  // 消息历史
  messages: Message[];
  
  // 图片附件
  imageAttachments: ImageAttachment[];
  
  // AI 配置状态
  configStatus: 'checking' | 'configured' | 'not_configured';
}
```

---

## 5. 交互逻辑规格

### 5.1 模式切换

| 快捷键 | 功能 |
|-------|------|
| `Tab` | 切换 Plan / Build Agent 模式 |
| `Ctrl+K` | 打开命令面板 |
| `Ctrl+L` | 查看日志 |
| `Ctrl+A` | 切换会话 |
| `Ctrl+?` | 显示帮助 |

### 5.2 Plan vs Build 模式

| 模式 | 权限 | 用途 |
|-----|------|------|
| **Plan** | 只读（不能修改文件） | 分析代码、规划实现方案 |
| **Build** | 完全权限（可执行命令、修改文件） | 实际开发工作 |

---

## 6. API 接口需求

### 6.1 Chat API

```typescript
// POST /api/chat
interface ChatRequest {
  action: 'chat';
  prompt: string;
  images?: { dataUrl: string; type: string }[];
}

// GET /api/chat?action=config
interface ConfigResponse {
  config?: { apiKey: string };
  needsConfig: boolean;
}
```

### 6.2 其他 API

- `GET /api/files` - 获取文件树
- `POST /api/files/open` - 打开文件
- `GET /api/git/branches` - 获取分支列表
- `GET /api/git/commits` - 获取提交历史

---

## 7. 依赖清单

### 7.1 核心依赖

| 包名 | 用途 |
|-----|------|
| `@monaco-editor/react` | 代码编辑器 |
| `@anthropic-ai/sdk` | Claude API |
| `openai` | OpenAI API |
| `better-sqlite3` | 本地数据库 |
| `simple-git` | Git 操作 |
| `zustand` | 状态管理 |
| `lucide-react` | 图标库 |
| `react-markdown` | Markdown 渲染 |
| `react-syntax-highlighter` | 代码高亮 |
| `xlsx` | Excel 文件处理 |

---

## 8. 样式规格

### 8.1 颜色主题（深色模式）

```css
--bg-primary: #1e1e1e;      /* 主背景 */
--bg-secondary: #252526;    /* 次背景 */
--bg-tertiary: #2d2d2d;     /* 三阶背景 */
--bg-hover: #37373d;        /* 悬停背景 */
--bg-active: #094771;       /* 选中背景 */
--border-color: #3c3c3c;    /* 边框颜色 */
--text-primary: #cccccc;    /* 主要文字 */
--text-secondary: #858585;  /* 次要文字 */
--accent-color: #0078d4;    /* 强调色（蓝色）*/
--success-color: #4ec9b0;   /* 成功色 */
--warning-color: #dcdcaa;   /* 警告色 */
--error-color: #f14c4c;     /* 错误色 */
```

---

## 9. 文件结构

```
opencode-ide/
├── src/
│   ├── app/
│   │   ├── page.tsx          # 主入口
│   │   ├── layout.tsx        # 根布局
│   │   └── globals.css       # 全局样式
│   ├── components/
│   │   ├── layout/           # 布局组件
│   │   │   ├── index.tsx     # Sidebar, ActivityBar, StatusBar
│   │   ├── chat/             # 聊天组件
│   │   │   └── index.tsx     # ChatPanel, ChatInput
│   │   ├── editor/           # 编辑器组件
│   │   ├── repository/       # 仓库组件
│   │   ├── viewer/           # 文件查看器
│   │   ├── windows/          # 窗口管理（Electron）
│   │   └── common/           # 通用组件
│   ├── store/
│   │   └── index.ts          # Zustand 状态管理
│   └── lib/
│       └── utils.ts          # 工具函数
├── public/
├── package.json
└── next.config.ts
```

---

## 10. 实现优先级

| 优先级 | 模块 | 说明 |
|-------|------|------|
| **P0** | 基础布局 | Activity Bar + Sidebar + Content Area |
| **P0** | Chat Panel | 消息展示、输入框、发送功能 |
| **P1** | 状态管理 | Zustand 全局状态 |
| **P1** | AI 集成 | Chat API、流式响应 |
| **P2** | Editor | Monaco Editor 集成 |
| **P2** | Repository | Git 集成、分支管理 |
| **P3** | 高级功能 | 图片粘贴、@引用、/命令 |

---

## 参考资料

- **OpenCode 官方仓库**: https://github.com/anomalyco/opencode
- **官方文档**: https://opencode.ai/docs
- **当前项目路径**: D:\yoka open IDE\opencode-ide

---

*此文档由 AI 助手生成，供开发团队参考使用*  
*版本: v1.0（基础版本）*
